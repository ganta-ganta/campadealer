<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Campa Beverages - Admin Portal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    :root {
      --primary-color: #2c3e50;
      --secondary-color: #3498db;
      --accent-color: #e74c3c;
      --success-color: #27ae60;
      --warning-color: #f39c12;
    }
    
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background-color: #f8f9fa;
      color: #333;
    }
    
    .navbar-brand {
      font-weight: bold;
      color: var(--accent-color) !important;
    }
    
    .card {
      transition: all 0.3s ease;
      border: none;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      border-radius: 12px;
      overflow: hidden;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .btn-primary {
      background-color: var(--secondary-color);
      border-color: var(--secondary-color);
    }
    
    .btn-success {
      background-color: var(--success-color);
      border-color: var(--success-color);
    }
    
    .btn-warning {
      background-color: var(--warning-color);
      border-color: var(--warning-color);
    }
    
    .btn-danger {
      background-color: var(--accent-color);
      border-color: var(--accent-color);
    }
    
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .login-card {
      background: white;
      border-radius: 15px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
      overflow: hidden;
      width: 400px;
    }
    
    .status-pending { background-color: #fff3cd; color: #856404; }
    .status-approved { background-color: #d4edda; color: #155724; }
    .status-rejected { background-color: #f8d7da; color: #721c24; }
    
    .order-status-pending { background-color: #fff3cd; color: #856404; }
    .order-status-confirmed { background-color: #d1ecf1; color: #0c5460; }
    .order-status-delivered { background-color: #d4edda; color: #155724; }
    .order-status-cancelled { background-color: #f8d7da; color: #721c24; }
    
    .hidden { display: none !important; }
    
    .table-responsive {
      overflow-x: auto;
    }
    
    .product-image {
      height: 100px;
      object-fit: contain;
      width: 100%;
    }
  </style>
</head>
<body>

<!-- Login Page -->
<div id="loginPage" class="login-container">
  <div class="login-card">
    <div class="p-4">
      <div class="text-center mb-4">
        <i class="bi bi-shield-lock" style="font-size: 3rem; color: var(--primary-color);"></i>
        <h2 class="mt-2">Admin Portal</h2>
        <p class="text-muted">Campa Beverages Management System</p>
      </div>
      
      <div id="loginForm">
        <form onsubmit="login(event)">
          <div class="mb-3">
            <label class="form-label">Admin Email</label>
            <input type="email" id="loginEmail" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Password</label>
            <input type="password" id="loginPassword" class="form-control" required>
          </div>
          <button type="submit" class="btn btn-primary w-100 mb-3">Login</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Main App -->
<div id="mainApp" class="hidden">
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand" href="#">
        <i class="bi bi-shield-lock me-2"></i>
        Campa Admin
      </a>
      <div class="navbar-nav ms-auto">
        <span class="navbar-text me-3">Welcome, <span id="userName"></span></span>
        <button class="btn btn-outline-light" onclick="logout()">
          <i class="bi bi-box-arrow-right"></i>
          Logout
        </button>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container mt-4">
    <!-- Tabs -->
    <ul class="nav nav-tabs mb-4" id="mainTabs">
      <li class="nav-item">
        <a class="nav-link active" data-bs-toggle="tab" href="#dashboardTab">
          <i class="bi bi-speedometer2"></i> Dashboard
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-bs-toggle="tab" href="#retailersTab">
          <i class="bi bi-shop"></i> Retailers
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-bs-toggle="tab" href="#productsTab">
          <i class="bi bi-box-seam"></i> Products
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-bs-toggle="tab" href="#ordersTab">
          <i class="bi bi-bag-check"></i> Orders
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-bs-toggle="tab" href="#adminsTab">
          <i class="bi bi-people"></i> Admins
        </a>
      </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Dashboard Tab -->
      <div class="tab-pane fade show active" id="dashboardTab">
        <div class="row">
          <div class="col-md-4 mb-4">
            <div class="card h-100">
              <div class="card-body text-center">
                <h1 class="display-4" id="totalRetailers">0</h1>
                <p class="text-muted">Total Retailers</p>
                <a href="#" class="btn btn-sm btn-outline-primary" onclick="showRetailersTab()">View All</a>
              </div>
            </div>
          </div>
          <div class="col-md-4 mb-4">
            <div class="card h-100">
              <div class="card-body text-center">
                <h1 class="display-4" id="totalProducts">0</h1>
                <p class="text-muted">Total Products</p>
                <a href="#" class="btn btn-sm btn-outline-primary" onclick="showProductsTab()">View All</a>
              </div>
            </div>
          </div>
          <div class="col-md-4 mb-4">
            <div class="card h-100">
              <div class="card-body text-center">
                <h1 class="display-4" id="totalOrders">0</h1>
                <p class="text-muted">Total Orders</p>
                <a href="#" class="btn btn-sm btn-outline-primary" onclick="showOrdersTab()">View All</a>
              </div>
            </div>
          </div>
        </div>
        
        <div class="row">
          <div class="col-md-6 mb-4">
            <div class="card h-100">
              <div class="card-header">
                <h5>Recent Orders</h5>
              </div>
              <div class="card-body">
                <div id="recentOrders">
                  <!-- Recent orders will be loaded here -->
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6 mb-4">
            <div class="card h-100">
              <div class="card-header">
                <h5>Pending Approvals</h5>
              </div>
              <div class="card-body">
                <div id="pendingApprovals">
                  <!-- Pending approvals will be loaded here -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Retailers Tab -->
      <div class="tab-pane fade" id="retailersTab">
        <div class="row mb-4">
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-search"></i></span>
              <input type="text" id="retailerSearch" class="form-control" placeholder="Search retailers..." onkeyup="filterRetailers()">
            </div>
          </div>
          <div class="col-md-3">
            <select id="retailerStatusFilter" class="form-select" onchange="filterRetailers()">
              <option value="">All Status</option>
              <option value="approved">Approved</option>
              <option value="pending">Pending</option>
              <option value="rejected">Rejected</option>
            </select>
          </div>
          <div class="col-md-3">
            <button class="btn btn-primary w-100" onclick="showAddRetailerModal()">
              <i class="bi bi-plus-circle"></i> Add Retailer
            </button>
          </div>
        </div>
        
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Business Name</th>
                <th>Owner</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="retailersList">
              <!-- Retailers will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Products Tab -->
      <div class="tab-pane fade" id="productsTab">
        <div class="row mb-4">
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-search"></i></span>
              <input type="text" id="productSearch" class="form-control" placeholder="Search products..." onkeyup="filterProducts()">
            </div>
          </div>
          <div class="col-md-3">
            <select id="productCategoryFilter" class="form-select" onchange="filterProducts()">
              <option value="">All Categories</option>
              <option value="Cola">Cola</option>
              <option value="Fruit Drinks">Fruit Drinks</option>
              <option value="Energy Drinks">Energy Drinks</option>
              <option value="Soda">Soda</option>
              <option value="Water">Water</option>
            </select>
          </div>
          <div class="col-md-3">
            <button class="btn btn-primary w-100" onclick="showAddProductModal()">
              <i class="bi bi-plus-circle"></i> Add Product
            </button>
          </div>
        </div>
        
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Image</th>
                <th>Name</th>
                <th>Category</th>
                <th>Size</th>
                <th>Price</th>
                <th>Stock</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="productsList">
              <!-- Products will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Orders Tab -->
      <div class="tab-pane fade" id="ordersTab">
        <div class="row mb-4">
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-search"></i></span>
              <input type="text" id="orderSearch" class="form-control" placeholder="Search orders..." onkeyup="filterOrders()">
            </div>
          </div>
          <div class="col-md-3">
            <select id="orderStatusFilter" class="form-select" onchange="filterOrders()">
              <option value="">All Status</option>
              <option value="pending">Pending</option>
              <option value="confirmed">Confirmed</option>
              <option value="delivered">Delivered</option>
              <option value="cancelled">Cancelled</option>
            </select>
          </div>
          <div class="col-md-3">
            <select id="orderDateFilter" class="form-select" onchange="filterOrders()">
              <option value="">All Time</option>
              <option value="today">Today</option>
              <option value="week">This Week</option>
              <option value="month">This Month</option>
            </select>
          </div>
        </div>
        
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Retailer</th>
                <th>Date</th>
                <th>Items</th>
                <th>Total</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="ordersList">
              <!-- Orders will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Admins Tab -->
      <div class="tab-pane fade" id="adminsTab">
        <div class="row mb-4">
          <div class="col-md-6">
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-search"></i></span>
              <input type="text" id="adminSearch" class="form-control" placeholder="Search admins..." onkeyup="filterAdmins()">
            </div>
          </div>
          <div class="col-md-3">
            <select id="adminRoleFilter" class="form-select" onchange="filterAdmins()">
              <option value="">All Roles</option>
              <option value="super">Super Admin</option>
              <option value="admin">Admin</option>
              <option value="support">Support</option>
            </select>
          </div>
          <div class="col-md-3">
            <button class="btn btn-primary w-100" onclick="showAddAdminModal()">
              <i class="bi bi-plus-circle"></i> Add Admin
            </button>
          </div>
        </div>
        
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Last Login</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="adminsList">
              <!-- Admins will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Retailer Modal -->
<div class="modal fade" id="addRetailerModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add New Retailer</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="addRetailerForm">
          <div class="mb-3">
            <label class="form-label">Business Name</label>
            <input type="text" id="retailerBusinessName" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Owner Name</label>
            <input type="text" id="retailerOwnerName" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Email Address</label>
            <input type="email" id="retailerEmail" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Phone Number</label>
            <input type="tel" id="retailerPhone" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Business Address</label>
            <textarea id="retailerAddress" class="form-control" rows="3" required></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">GST Number (Optional)</label>
            <input type="text" id="retailerGST" class="form-control">
          </div>
          <div class="mb-3">
            <label class="form-label">Password</label>
            <input type="password" id="retailerPassword" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Status</label>
            <select id="retailerStatus" class="form-select">
              <option value="approved">Approved</option>
              <option value="pending">Pending</option>
              <option value="rejected">Rejected</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="addRetailer()">Save Retailer</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Retailer Modal -->
<div class="modal fade" id="editRetailerModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Retailer</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="editRetailerForm">
          <input type="hidden" id="editRetailerId">
          <div class="mb-3">
            <label class="form-label">Business Name</label>
            <input type="text" id="editRetailerBusinessName" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Owner Name</label>
            <input type="text" id="editRetailerOwnerName" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Email Address</label>
            <input type="email" id="editRetailerEmail" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Phone Number</label>
            <input type="tel" id="editRetailerPhone" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Business Address</label>
            <textarea id="editRetailerAddress" class="form-control" rows="3" required></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">GST Number (Optional)</label>
            <input type="text" id="editRetailerGST" class="form-control">
          </div>
          <div class="mb-3">
            <label class="form-label">Status</label>
            <select id="editRetailerStatus" class="form-select">
              <option value="approved">Approved</option>
              <option value="pending">Pending</option>
              <option value="rejected">Rejected</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="updateRetailer()">Update Retailer</button>
      </div>
    </div>
  </div>
</div>

<!-- Add Product Modal -->
<div class="modal fade" id="addProductModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add New Product</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="addProductForm">
          <div class="mb-3">
            <label class="form-label">Product Name</label>
            <input type="text" id="productName" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Category</label>
            <select id="productCategory" class="form-select" required>
              <option value="Cola">Cola</option>
              <option value="Fruit Drinks">Fruit Drinks</option>
              <option value="Energy Drinks">Energy Drinks</option>
              <option value="Soda">Soda</option>
              <option value="Water">Water</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Size</label>
            <input type="text" id="productSize" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Price (₹)</label>
            <input type="number" id="productPrice" class="form-control" min="0" step="0.01" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Stock Quantity</label>
            <input type="number" id="productStock" class="form-control" min="0" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Image URL</label>
            <input type="url" id="productImage" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea id="productDescription" class="form-control" rows="3" required></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Status</label>
            <select id="productStatus" class="form-select">
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="addProduct()">Add Product</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Product Modal -->
<div class="modal fade" id="editProductModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Product</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="editProductForm">
          <input type="hidden" id="editProductId">
          <div class="mb-3">
            <label class="form-label">Product Name</label>
            <input type="text" id="editProductName" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Category</label>
            <select id="editProductCategory" class="form-select" required>
              <option value="Cola">Cola</option>
              <option value="Fruit Drinks">Fruit Drinks</option>
              <option value="Energy Drinks">Energy Drinks</option>
              <option value="Soda">Soda</option>
              <option value="Water">Water</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Size</label>
            <input type="text" id="editProductSize" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Price (₹)</label>
            <input type="number" id="editProductPrice" class="form-control" min="0" step="0.01" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Stock Quantity</label>
            <input type="number" id="editProductStock" class="form-control" min="0" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Image URL</label>
            <input type="url" id="editProductImage" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea id="editProductDescription" class="form-control" rows="3" required></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Status</label>
            <select id="editProductStatus" class="form-select">
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="updateProduct()">Update Product</button>
      </div>
    </div>
  </div>
</div>

<!-- Order Details Modal -->
<div class="modal fade" id="orderDetailsModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Order Details - <span id="orderDetailsId"></span></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row mb-4">
          <div class="col-md-6">
            <h6>Retailer Information</h6>
            <p><strong>Name:</strong> <span id="orderRetailerName"></span></p>
            <p><strong>Email:</strong> <span id="orderRetailerEmail"></span></p>
            <p><strong>Phone:</strong> <span id="orderRetailerPhone"></span></p>
            <p><strong>Address:</strong> <span id="orderRetailerAddress"></span></p>
          </div>
          <div class="col-md-6">
            <h6>Order Information</h6>
            <p><strong>Date:</strong> <span id="orderDate"></span></p>
            <p><strong>Status:</strong> <span id="orderStatus" class="badge"></span></p>
            <p><strong>Total Items:</strong> <span id="orderTotalItems"></span></p>
            <p><strong>Total Amount:</strong> ₹<span id="orderTotalAmount"></span></p>
          </div>
        </div>
        
        <h6>Order Items</h6>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Product</th>
                <th>Size</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody id="orderItemsList">
              <!-- Order items will be loaded here -->
            </tbody>
          </table>
        </div>
        
        <div class="row mt-3">
          <div class="col-md-6">
            <div class="form-floating">
              <select class="form-select" id="updateOrderStatus">
                <option value="pending">Pending</option>
                <option value="confirmed">Confirmed</option>
                <option value="delivered">Delivered</option>
                <option value="cancelled">Cancelled</option>
              </select>
              <label for="updateOrderStatus">Update Status</label>
            </div>
          </div>
          <div class="col-md-6 text-end">
            <button class="btn btn-primary" onclick="printOrderInvoice()">
              <i class="bi bi-printer"></i> Print Invoice
            </button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-success" onclick="updateOrderStatus()">Update Status</button>
      </div>
    </div>
  </div>
</div>

<!-- Add Admin Modal -->
<div class="modal fade" id="addAdminModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add New Admin</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="addAdminForm">
          <div class="mb-3">
            <label class="form-label">Full Name</label>
            <input type="text" id="adminName" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Email Address</label>
            <input type="email" id="adminEmail" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Password</label>
            <input type="password" id="adminPassword" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Role</label>
            <select id="adminRole" class="form-select" required>
              <option value="super">Super Admin</option>
              <option value="admin">Admin</option>
              <option value="support">Support</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="addAdmin()">Add Admin</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Admin Modal -->
<div class="modal fade" id="editAdminModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Admin</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="editAdminForm">
          <input type="hidden" id="editAdminId">
          <div class="mb-3">
            <label class="form-label">Full Name</label>
            <input type="text" id="editAdminName" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Email Address</label>
            <input type="email" id="editAdminEmail" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Role</label>
            <select id="editAdminRole" class="form-select" required>
              <option value="super">Super Admin</option>
              <option value="admin">Admin</option>
              <option value="support">Support</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="updateAdmin()">Update Admin</button>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

// Import Firebase modules
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { 
  getAuth, 
  signInWithEmailAndPassword, 
  createUserWithEmailAndPassword,
  signOut,
  onAuthStateChanged 
} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import { 
  getFirestore,
  collection,
  doc,
  setDoc,
  getDoc,
  getDocs,
  addDoc,
  updateDoc,
  deleteDoc,
  query,
  where,
  orderBy,
  limit,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

// Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyBm2Y2-KaPh_9prtDyEh75ys9bOS_YivyU",
  authDomain: "campacola-45a6c.firebaseapp.com",
  projectId: "campacola-45a6c",
  storageBucket: "campacola-45a6c.appspot.com",
  messagingSenderId: "950062364838",
  appId: "1:950062364838:web:c016c1c2b63d661dc09c67",
  measurementId: "G-0F1FMP4D6X"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Global variables
let currentUser = null;
let currentAdmin = null;
let retailers = [];
let products = [];
let orders = [];
let admins = [];
let currentOrder = null;
const ADMIN_UID = 'KX8MHQ5bRvgFndwV2FriiSjyEKi1'; // The only authorized admin UID

// Initialize app
function initApp() {
  // Check if user is logged in
  onAuthStateChanged(auth, async (user) => {
    if (user && user.uid === ADMIN_UID) {
      currentUser = user;
      await checkAdminStatus();
    } else {
      showLoginPage();
      if (user) await signOut(auth); // Sign out any non-admin users
    }
  });
}

// Show/Hide pages
function showLoginPage() {
  document.getElementById('loginPage').classList.remove('hidden');
  document.getElementById('mainApp').classList.add('hidden');
}

function showMainApp() {
  document.getElementById('loginPage').classList.add('hidden');
  document.getElementById('mainApp').classList.remove('hidden');
  loadDashboard();
  loadRetailers();
  loadProducts();
  loadOrders();
  loadAdmins();
}

// Check if user is admin
async function checkAdminStatus() {
  const adminDoc = await getDoc(doc(db, 'admins', currentUser.uid));
  
  // Verify both the document exists and the UID matches
  if (adminDoc.exists() && currentUser.uid === ADMIN_UID) {
    currentAdmin = adminDoc.data();
    document.getElementById('userName').textContent = currentAdmin.name;
    
    // Hide admin management tab if not super admin
    if (currentAdmin.role !== 'super') {
      document.querySelector('[href="#adminsTab"]').parentElement.classList.add('hidden');
    }
    
    showMainApp();
  } else {
    alert('You are not authorized to access this portal');
    await signOut(auth);
    showLoginPage();
  }
}

// Authentication functions
async function login(event) {
  event.preventDefault();
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;

  try {
    // Show loading state
    const loginBtn = event.target.querySelector('button[type="submit"]');
    loginBtn.disabled = true;
    loginBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Authenticating...';

    // Sign in with Firebase Auth
    const userCredential = await signInWithEmailAndPassword(auth, email, password);
    currentUser = userCredential.user;

    // Verify this is the specific admin user by UID
    if (currentUser.uid !== ADMIN_UID) {
      await signOut(auth);
      alert('Access restricted to authorized admin only');
      loginBtn.disabled = false;
      loginBtn.innerHTML = 'Login';
      return;
    }

    // Success - proceed to admin dashboard
    await checkAdminStatus();
    
  } catch (error) {
    console.error('Login error:', error);
    
    // User-friendly error messages
    let errorMessage = 'Login failed. Please try again.';
    switch (error.code) {
      case 'auth/wrong-password':
        errorMessage = 'Incorrect password';
        break;
      case 'auth/user-not-found':
        errorMessage = 'User not found';
        break;
    }
    
    alert(errorMessage);
    const loginBtn = event.target.querySelector('button[type="submit"]');
    loginBtn.disabled = false;
    loginBtn.innerHTML = 'Login';
  }
}

async function logout() {
  await signOut(auth);
  currentUser = null;
  currentAdmin = null;
  showLoginPage();
}

// Dashboard functions
async function loadDashboard() {
  // Load counts
  const retailerCount = (await getDocs(collection(db, 'retailers'))).size;
  const productCount = (await getDocs(collection(db, 'products'))).size;
  const orderCount = (await getDocs(collection(db, 'retailerOrders'))).size;
  
  document.getElementById('totalRetailers').textContent = retailerCount;
  document.getElementById('totalProducts').textContent = productCount;
  document.getElementById('totalOrders').textContent = orderCount;
  
  // Load recent orders
  const recentOrdersQuery = query(
    collection(db, 'retailerOrders'),
    orderBy('createdAt', 'desc'),
    limit(5)
  );
  
  const recentOrdersSnapshot = await getDocs(recentOrdersQuery);
  const recentOrdersList = document.getElementById('recentOrders');
  recentOrdersList.innerHTML = '';
  
  recentOrdersSnapshot.forEach(doc => {
    const order = doc.data();
    const orderItem = createRecentOrderItem(order);
    recentOrdersList.appendChild(orderItem);
  });
  
  // Load pending approvals
  const pendingApprovalsQuery = query(
    collection(db, 'retailers'),
    where('isApproved', '==', false),
    limit(5)
  );
  
  const pendingApprovalsSnapshot = await getDocs(pendingApprovalsQuery);
  const pendingApprovalsList = document.getElementById('pendingApprovals');
  pendingApprovalsList.innerHTML = '';
  
  pendingApprovalsSnapshot.forEach(doc => {
    const retailer = doc.data();
    retailer.id = doc.id;
    const retailerItem = createPendingApprovalItem(retailer);
    pendingApprovalsList.appendChild(retailerItem);
  });
}

function createRecentOrderItem(order) {
  const div = document.createElement('div');
  div.className = 'd-flex justify-content-between align-items-center mb-3 p-2 border-bottom';
  
  const statusClass = `order-status-${order.status}`;
  const statusText = order.status.charAt(0).toUpperCase() + order.status.slice(1);
  
  div.innerHTML = `
    <div>
      <h6 class="mb-1">${order.invoiceNumber}</h6>
      <small class="text-muted">${order.retailerName}</small>
    </div>
    <div class="text-end">
      <div class="fw-bold">₹${order.total.toFixed(2)}</div>
      <span class="badge ${statusClass}">${statusText}</span>
    </div>
  `;
  
  div.addEventListener('click', () => viewOrderDetails(order));
  return div;
}

function createPendingApprovalItem(retailer) {
  const div = document.createElement('div');
  div.className = 'd-flex justify-content-between align-items-center mb-3 p-2 border-bottom';
  
  div.innerHTML = `
    <div>
      <h6 class="mb-1">${retailer.businessName}</h6>
      <small class="text-muted">${retailer.ownerName}</small>
    </div>
    <div>
      <button class="btn btn-sm btn-success me-1" onclick="approveRetailer('${retailer.id}', event)">
        <i class="bi bi-check"></i>
      </button>
      <button class="btn btn-sm btn-danger" onclick="rejectRetailer('${retailer.id}', event)">
        <i class="bi bi-x"></i>
      </button>
    </div>
  `;
  
  return div;
}

// [Rest of your existing functions for retailers, products, orders, and admins...]
// (Keep all your existing functions for managing retailers, products, orders, and admins)

// Expose functions to global scope
window.login = login;
window.logout = logout;
window.addRetailer = addRetailer;
window.editRetailer = editRetailer;
window.updateRetailer = updateRetailer;
window.approveRetailer = approveRetailer;
window.rejectRetailer = rejectRetailer;
window.deleteRetailer = deleteRetailer;
window.addProduct = addProduct;
window.editProduct = editProduct;
window.updateProduct = updateProduct;
window.deleteProduct = deleteProduct;
window.viewOrderDetails = viewOrderDetails;
window.updateOrderStatus = updateOrderStatus;
window.printOrderInvoice = printOrderInvoice;
window.showRetailersTab = showRetailersTab;
window.showProductsTab = showProductsTab;
window.showOrdersTab = showOrdersTab;
window.showAddRetailerModal = showAddRetailerModal;
window.showAddProductModal = showAddProductModal;
window.showAddAdminModal = showAddAdminModal;
window.filterRetailers = filterRetailers;
window.filterProducts = filterProducts;
window.filterOrders = filterOrders;
window.filterAdmins = filterAdmins;
window.addAdmin = addAdmin;
window.editAdmin = editAdmin;
window.updateAdmin = updateAdmin;
window.deleteAdmin = deleteAdmin;

// Initialize app when page loads
window.addEventListener('load', initApp);
</script>
</body>
</html>
